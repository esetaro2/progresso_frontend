<app-loading-spinner *ngIf="loading"></app-loading-spinner>
<h2 class="text-center mb-4" mat-dialog-title>Create Team</h2>
<div mat-dialog-content>
  <form [formGroup]="teamForm">
    <div class="mb-3">
      <label for="name">Name</label>
      <input
        type="text"
        id="name"
        class="form-control"
        formControlName="name"
        required
        (input)="onInput('name')"
      />
      <small>
        <span
          *ngIf="teamForm.get('name')?.touched && teamForm.get('name')?.invalid"
        >
          <i class="fa fa-times"></i>
          <span *ngIf="teamForm.get('name')?.errors?.['required']">
            Team name is required.
          </span>
          <span *ngIf="teamForm.get('name')?.errors?.['minlength']">
            Team name is too short.
          </span>
          <span *ngIf="teamForm.get('name')?.errors?.['maxlength']">
            Team name is too long.
          </span>
        </span>
        <span
          *ngIf="teamForm.get('name')?.touched && teamForm.get('name')?.valid"
        >
          <i class="fa fa-check"></i> Team name is valid.
        </span>
        <span *ngIf="!teamForm.get('name')?.touched">
          Please enter the team name.
        </span>
      </small>
    </div>
  </form>

  <div class="table-container">
    <div class="d-flex align-items-center">
      <div class="input-group position-relative">
        <input
          name="searchInput"
          placeholder="Search..."
          [(ngModel)]="searchQuery"
          class="form-control"
          style="border-top-right-radius: 4px; border-bottom-right-radius: 4px"
          (keydown.enter)="applyFilter()"
        />
        <mat-icon
          class="position-absolute top-0 end-0 search-icon"
          style="
            height: 100%;
            margin-right: 10px;
            display: flex;
            align-items: center;
            z-index: 12;
          "
        >
          search
        </mat-icon>
      </div>
      <button
        mat-button
        [ngClass]="{
          invisible: !isSearchQueryPresent,
        }"
        (click)="resetAllFilters()"
      >
        <i class="fa fa-times"></i>
      </button>
    </div>

    <table
      mat-table
      [dataSource]="dataSource"
      matSort
      *ngIf="dataSource.data.length !== 0"
    >
      <!-- Definizione delle colonne -->
      <ng-container matColumnDef="id">
        <th mat-header-cell *matHeaderCellDef>ID</th>
        <td mat-cell *matCellDef="let tm">{{ tm.id }}</td>
      </ng-container>

      <ng-container matColumnDef="firstName">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>First Name</th>
        <td mat-cell *matCellDef="let tm">{{ tm.firstName }}</td>
      </ng-container>

      <ng-container matColumnDef="lastName">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Last Name</th>
        <td mat-cell *matCellDef="let tm">{{ tm.lastName }}</td>
      </ng-container>

      <ng-container matColumnDef="username">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Username</th>
        <td mat-cell *matCellDef="let tm">{{ tm.username }}</td>
      </ng-container>

      <!-- Righe della tabella -->
      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr
        mat-row
        *matRowDef="let row; columns: displayedColumns"
        (click)="onRowClicked(row)"
        [class.selected]="selection.isSelected(row)"
        class="tableRow"
      ></tr>
    </table>
    <mat-paginator
      *ngIf="dataSource.data.length !== 0"
      [length]="totalElements"
      [hidePageSize]="true"
      [pageSize]="pageSize"
      (page)="onPageChange($event)"
    ></mat-paginator>
  </div>
  <h5
    style="color: #3080f7"
    *ngIf="dataSource.data.length === 0"
    class="text-center mt-5"
  >
    {{ errorMessage }}
  </h5>
</div>
<div mat-dialog-actions>
  <button mat-button matDialogClose>Cancel</button>
  <button
    mat-button
    [disabled]="teamForm.invalid || selection.isEmpty()"
    (click)="createTeam()"
  >
    Create And Assign Team
  </button>
</div>
