<mat-progress-bar mode="indeterminate" *ngIf="isLoading"></mat-progress-bar>

<div *ngIf="errorStates.tasks" class="alert alert-danger text-center">
  {{ errorStates.tasks }}
</div>

<div *ngIf="!errorStates.tasks">
  <div class="table-container">
    <div class="table-wrapper">
      <table
        mat-table
        [dataSource]="dataSource"
        matSort
        (matSortChange)="sortData($event)"
        style="background-color: transparent"
      >
        <ng-container matColumnDef="name">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Name</th>
          <td mat-cell *matCellDef="let task">{{ task.name }}</td>
        </ng-container>

        <ng-container matColumnDef="startDate">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Start Date</th>
          <td mat-cell *matCellDef="let task">{{ task.startDate }}</td>
        </ng-container>

        <ng-container matColumnDef="dueDate">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Due Date</th>
          <td mat-cell *matCellDef="let task">{{ task.dueDate }}</td>
        </ng-container>

        <ng-container matColumnDef="completionDate">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>
            Completion Date
          </th>
          <td mat-cell *matCellDef="let task">{{ task.completionDate }}</td>
        </ng-container>

        <ng-container matColumnDef="priority">
          <th mat-header-cell *matHeaderCellDef>Priority</th>
          <td
            mat-cell
            *matCellDef="let task"
            [ngClass]="getPriorityClass(task.priority)"
          >
            {{ task.priority }}
          </td>
        </ng-container>

        <ng-container matColumnDef="status">
          <th mat-header-cell *matHeaderCellDef>Status</th>
          <td mat-cell *matCellDef="let task">
            <mat-icon
              style="cursor: pointer; overflow: visible"
              [ngbTooltip]="getTooltipText(task.status)"
              [ngClass]="getStatusClass(task.status)"
              >circle</mat-icon
            >
          </td>
        </ng-container>

        <ng-container matColumnDef="owner">
          <th mat-header-cell *matHeaderCellDef>Owner</th>
          <td mat-cell *matCellDef="let task">{{ task.ownerUsername }}</td>
        </ng-container>

        <ng-container matColumnDef="description">
          <th mat-header-cell *matHeaderCellDef>Description</th>
          <td mat-cell *matCellDef="let task">
            <span class="task-description" [title]="task.description">
              {{ task.description }}
            </span>
          </td>
        </ng-container>

        <ng-container matColumnDef="actions">
          <th mat-header-cell *matHeaderCellDef>Actions</th>
          <td mat-cell *matCellDef="let task">
            <button
              mat-icon-button
              class="btn complete-button"
              [disabled]="task.status === 'COMPLETED' || isLoading"
              (click)="openCompleteDialog(task)"
            >
              <mat-icon>check</mat-icon>
            </button>
            <button
              mat-icon-button
              class="btn btn-outline-primary"
              [disabled]="task.status === 'COMPLETED' || isLoading"
              (click)="openEditDialog(task)"
            >
              <mat-icon>edit</mat-icon>
            </button>
            <button
              mat-icon-button
              class="btn btn-outline-danger"
              [disabled]="task.status === 'COMPLETED' || isLoading"
              (click)="openDeleteDialog(task)"
            >
              <mat-icon>delete</mat-icon>
            </button>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr
          mat-row
          *matRowDef="let row; columns: displayedColumns"
          class="tableRow"
        ></tr>
      </table>
    </div>
  </div>

  <mat-paginator
    [length]="totalElements"
    [hidePageSize]="true"
    [pageSize]="pageSize"
    (page)="onPageChange($event)"
    style="background-color: transparent"
  ></mat-paginator>
</div>
